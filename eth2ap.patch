30a31
> static bool s_mac_is_set = false;
41a43,52
> static void ethernet2wifi_mac_status_set(bool status)
> {
>     s_mac_is_set = status;
> }
> 
> static bool ethernet2wifi_mac_status_get(void)
> {
>     return s_mac_is_set;
> }
> 
82c93
<             if (s_sta_is_connected && msg.length) {
---
>             if (msg.length) {
83a95,101
>                     if (!ethernet2wifi_mac_status_get()) {
>                         memcpy(s_eth_mac, (uint8_t*)msg.packet + 6, sizeof(s_eth_mac));
>                         ESP_ERROR_CHECK(esp_wifi_start());
>                         esp_wifi_set_mac(WIFI_IF_STA, s_eth_mac);
>                         esp_wifi_connect();
>                         ethernet2wifi_mac_status_set(true);
>                     }
86c104
<                     res = esp_wifi_internal_tx(WIFI_IF_AP, msg.packet, msg.length);
---
>                     res = esp_wifi_internal_tx(WIFI_IF_STA, msg.packet, msg.length);
107,108d124
<         esp_wifi_set_mac(WIFI_IF_AP, s_eth_mac);
<         ESP_ERROR_CHECK(esp_wifi_start());
111a128
>         ethernet2wifi_mac_status_set(false);
132,133c149,153
<     case WIFI_EVENT_AP_STACONNECTED:
<         ESP_LOGI(TAG, "Wi-Fi AP got a station connected");
---
>     case WIFI_EVENT_STA_START:
>         esp_wifi_connect();
>         break;
>     case WIFI_EVENT_STA_CONNECTED:
>         ESP_LOGI(TAG, "Wi-Fi station connected");
136c156
<             esp_wifi_internal_reg_rxcb(WIFI_IF_AP, pkt_wifi2eth);
---
>             esp_wifi_internal_reg_rxcb(WIFI_IF_STA, pkt_wifi2eth);
140,141c160,161
<     case WIFI_EVENT_AP_STADISCONNECTED:
<         ESP_LOGI(TAG, "Wi-Fi AP got a station disconnected");
---
>     case WIFI_EVENT_STA_DISCONNECTED:
>         ESP_LOGI(TAG, "Wi-Fi station disconnected");
145c165
<             esp_wifi_internal_reg_rxcb(WIFI_IF_AP, NULL);
---
>             esp_wifi_internal_reg_rxcb(WIFI_IF_STA, NULL);
146a167
>         esp_wifi_connect();
257c278
<         .ap = {
---
>         .sta = {
259d279
<             .ssid_len = strlen(CONFIG_EXAMPLE_WIFI_SSID),
261,263c281
<             .max_connection = CONFIG_EXAMPLE_MAX_STA_CONN,
<             .authmode = WIFI_AUTH_WPA_WPA2_PSK,
<             .channel = CONFIG_EXAMPLE_WIFI_CHANNEL // default: channel 1
---
>             .threshold.authmode = WIFI_AUTH_WPA2_PSK
266,270c284,285
<     if (strlen(CONFIG_EXAMPLE_WIFI_PASSWORD) == 0) {
<         wifi_config.ap.authmode = WIFI_AUTH_OPEN;
<     }
<     ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_AP));
<     ESP_ERROR_CHECK(esp_wifi_set_config(WIFI_IF_AP, &wifi_config));
---
>     ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_STA));
>     ESP_ERROR_CHECK(esp_wifi_set_config(WIFI_IF_STA, &wifi_config));
